window.Kamome=function(e){var n=function(){return navigator.userAgent.toLowerCase().indexOf("android")>0},t=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>0||e.indexOf("ipad")>0||e.indexOf("ipod")>0},i={requestTimeout:"RequestTimeout",rejected:"Rejected"},r={},u={},a=[],o=!1,l=null,c=1e4,s=function(e){return c=e,this},m=function(e,n){return r[e]=n,this},d=function(e){return e in r&&delete r[e],this},f=function(n,t,i,r){return null!==r&&r!==e||(r=c),i?(a.push({name:n,data:t,timeout:r,callback:i}),k(),null):new Promise(function(e,i){a.push({name:n,data:t,timeout:r,resolve:e,reject:i}),k()})},k=function(){if(!o){o=!0;var e=a[0],r=JSON.stringify({name:e.name,data:e.data});t()&&"webkit"in window?setTimeout(function(){window.webkit.messageHandlers.kamomeSend.postMessage(r)},0):n()&&"kamomeAndroid"in window?setTimeout(function(){window.kamomeAndroid.kamomeSend(r)},0):e.name in u&&setTimeout(function(){var n=function(e){return function(n){w(e,n?JSON.stringify(n):null)}}(e.name),t=function(e){return function(n){b(e,n)}}(e.name);u[e.name](e.data,n,t)},0),e.timeout>0&&(v(),l=setTimeout(function(){v(),o=!1;var e=a.shift();"callback"in e?e.callback(null,i.requestTimeout+":"+e.name):"reject"in e&&e.reject(i.requestTimeout+":"+e.name),a.length>0&&k()},e.timeout))}},v=function(){null!==l&&(clearTimeout(l),l=null)},w=function(e,n,t){v(),o=!1;var i=n?JSON.parse(n):null,r=a.shift();return e===r.name&&("callback"in r?r.callback(i,null):"resolve"in r&&r.resolve(i)),a.length>0&&k(),null},b=function(e,n){v(),o=!1;var t=n?":"+n:"",r=a.shift();return e===r.name&&("callback"in r?r.callback(null,i.rejected+":"+r.name+t):"reject"in r&&r.reject(i.rejected+":"+r.name+t)),a.length>0&&k(),null},g=function(e,t,i){if(e in r){var u=r[e](t?JSON.parse(t):null);return n()?{callbackId:i,result:u}:JSON.stringify({callbackId:i,result:u})}return n()?{callbackId:i,result:null}:JSON.stringify({callbackId:i,result:null})},h=function(e,n){return u[e]=n,this};return{Error:i,setRequestTimeout:s,addReceiver:m,removeReceiver:d,send:f,onComplete:w,onError:b,onReceive:g,addWebHandler:h}}();