window.Kamome=function(){var e=function(){return navigator.userAgent.toLowerCase().indexOf("android")>0},n=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>0||e.indexOf("ipad")>0||e.indexOf("ipod")>0},t={requestTimeout:"RequestTimeout"},i={},r={},a=[],u=!1,o=null,l=1e4,c=function(e){return l=e,this},s=function(e,n){return i[e]=n,this},d=function(e){return e in i&&delete i[e],this},m=function(e,n,t){return t?(a.push({name:e,data:n,callback:t}),f(),null):new Promise(function(t,i){a.push({name:e,data:n,resolve:t,reject:i}),f()})},f=function(){if(!u){u=!0;var i=a[0],c=JSON.stringify({name:i.name,data:i.data});n()?"webkit"in window&&setTimeout(function(){window.webkit.messageHandlers.kamomeSend.postMessage(c)},0):e()?"kamomeAndroid"in window&&setTimeout(function(){window.kamomeAndroid.kamomeSend(c)},0):i.name in r&&setTimeout(function(){var e=function(e){return function(n){k(e,n?JSON.stringify(n):null)}}(i.name);r[i.name](i.data,e)},0),l>0&&(v(),o=setTimeout(function(){v(),u=!1;var e=a.shift();"callback"in e?e.callback(null,t.requestTimeout):"reject"in e&&e.reject(t.requestTimeout),a.length>0&&f()},l))}},v=function(){null!==o&&(clearTimeout(o),o=null)},k=function(e,n,t){v(),u=!1;var i=n?JSON.parse(n):null,r=a.shift();return e===r.name&&("callback"in r?r.callback(i):"resolve"in r&&r.resolve(i)),a.length>0&&f(),null},w=function(n,t,r){if(n in i){var a=i[n](t?JSON.parse(t):null);return e()?{callbackId:r,result:a}:JSON.stringify({callbackId:r,result:a})}return e()?{callbackId:r,result:null}:JSON.stringify({callbackId:r,result:null})},b=function(e,n){return r[e]=n,this};return{Error:t,setRequestTimeout:c,addReceiver:s,removeReceiver:d,send:m,onComplete:k,onReceive:w,addWebHandler:b}}();