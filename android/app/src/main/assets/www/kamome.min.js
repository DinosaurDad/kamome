window.Kamome=function(e){var n=function(){return navigator.userAgent.toLowerCase().indexOf("android")>0},t=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>0||e.indexOf("ipad")>0||e.indexOf("ipod")>0},i={requestTimeout:"RequestTimeout",rejected:"Rejected",canceled:"Canceled"},a={},r={},u=[],l=!1,c=null,o=1e4,s=function(e){return o=e,this},d=function(e,n){return a[e]=n,this},m=function(e){return e in a&&delete a[e],this},f=function(n,t,i,a){return null!==a&&a!==e||(a=o),i?(u.push({name:n,data:t,timeout:a,callback:i}),v(),null):new Promise(function(e,i){u.push({name:n,data:t,timeout:a,resolve:e,reject:i}),v()})},k=function(e){if(0!==u.length){b(),l=!1;var n=e?":"+e:"",t=u.shift();"callback"in t?t.callback(null,i.canceled+":"+t.name+n):"reject"in t&&t.reject(i.canceled+":"+t.name+n),u.length>0&&v()}},v=function(){if(!l){l=!0;var e=u[0],a=JSON.stringify({name:e.name,data:e.data});t()&&"webkit"in window?setTimeout(function(){window.webkit.messageHandlers.kamomeSend.postMessage(a)},0):n()&&"kamomeAndroid"in window?setTimeout(function(){window.kamomeAndroid.kamomeSend(a)},0):e.name in r&&setTimeout(function(){var n=function(e){return function(n){h(e,n?JSON.stringify(n):null)}}(e.name),t=function(e){return function(n){g(e,n)}}(e.name);r[e.name](e.data,n,t)},0),e.timeout>0&&(b(),c=setTimeout(function(){b(),l=!1;var e=u.shift();"callback"in e?e.callback(null,i.requestTimeout+":"+e.name):"reject"in e&&e.reject(i.requestTimeout+":"+e.name),u.length>0&&v()},e.timeout))}},b=function(){null!==c&&(clearTimeout(c),c=null)},h=function(e,n,t){b(),l=!1;var i=n?JSON.parse(n):null,a=u.shift();return e===a.name&&("callback"in a?a.callback(i,null):"resolve"in a&&a.resolve(i)),u.length>0&&v(),null},g=function(e,n){b(),l=!1;var t=n?":"+n:"",a=u.shift();return e===a.name&&("callback"in a?a.callback(null,i.rejected+":"+a.name+t):"reject"in a&&a.reject(i.rejected+":"+a.name+t)),u.length>0&&v(),null},w=function(e,t,i){if(e in a){var r=a[e](t?JSON.parse(t):null);return n()?{callbackId:i,result:r}:JSON.stringify({callbackId:i,result:r})}return n()?{callbackId:i,result:null}:JSON.stringify({callbackId:i,result:null})},j=function(e,n){return r[e]=n,this};return{Error:i,setDefaultRequestTimeout:s,addReceiver:d,removeReceiver:m,send:f,cancelCurrentRequest:k,onComplete:h,onError:g,onReceive:w,addWebHandler:j}}();