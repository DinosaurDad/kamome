window.Kamome=function(e){var n={requestTimeout:"RequestTimeout",rejected:"Rejected",canceled:"Canceled"},t={},i={},r=[],a=!1,u=1e4,c=function(e){return u=e,this},o=function(e,n){return t[e]=n,this},l=function(e){return e in t&&delete t[e],this},d=function(n,t,i,a){return null!==a&&a!==e||(a=u),i?(r.push({id:g(),name:n,data:t,timeout:a,callback:i}),s(),null):new Promise(function(e,i){r.push({id:g(),name:n,data:t,timeout:a,resolve:e,reject:i}),s()})},f=function(e){if(0!==r.length){a=!1;var t=e?":"+e:"";m(function(e){"callback"in e?e.callback(null,n.canceled+":"+e.name+t):"reject"in e&&e.reject(n.canceled+":"+e.name+t)})}},s=function(){if(0!==r.length&&!a){a=!0;var e=r[0],t=JSON.stringify({name:e.name,data:e.data,id:e.id});k()&&"webkit"in window?setTimeout(function(){window.webkit.messageHandlers.kamomeSend.postMessage(t)},0):x()&&"kamomeAndroid"in window?setTimeout(function(){window.kamomeAndroid.kamomeSend(t)},0):e.name in i&&setTimeout(function(){var n=function(e,n){return function(t){v(e,t?JSON.stringify(t):null,n)}}(e.name,e.id),t=function(e,n){return function(t){b(e,t,n)}}(e.name,e.id);i[e.name](e.data,n,t)},0),e.timeout>0&&setTimeout(function(e){return function(){a=!1,r.length>0&&r[0].id===e&&m(function(e){"callback"in e?e.callback(null,n.requestTimeout+":"+e.name):"reject"in e&&e.reject(n.requestTimeout+":"+e.name)})}}(e.id),e.timeout)}},m=function(e){e(r.shift()),s()},x=function(){return navigator.userAgent.toLowerCase().indexOf("android")>0},k=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("iphone")>0||e.indexOf("ipad")>0||e.indexOf("ipod")>0},g=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=16*Math.random()|0,t="x"===e?n:3&n|8;return t.toString(16)}).toLowerCase()},v=function(e,n){if(a=!1,r.length>0&&r[0].id===n){var t=e?JSON.parse(e):null;m(function(e){"callback"in e?e.callback(t,null):"resolve"in e&&e.resolve(t)})}return null},b=function(e,t){if(a=!1,r.length>0&&r[0].id===t){var i=e?":"+e:"";m(function(e){"callback"in e?e.callback(null,n.rejected+":"+e.name+i):"reject"in e&&e.reject(n.rejected+":"+e.name+i)})}return null},w=function(e,n,i){if(e in t){var r=t[e](n?JSON.parse(n):null);return x()?{callbackId:i,result:r}:JSON.stringify({callbackId:i,result:r})}return x()?{callbackId:i,result:null}:JSON.stringify({callbackId:i,result:null})},h=function(e,n){return i[e]=n,this};return{Error:n,setDefaultRequestTimeout:c,addReceiver:o,removeReceiver:l,send:d,cancelCurrentRequest:f,onComplete:v,onError:b,onReceive:w,addWebHandler:h}}();